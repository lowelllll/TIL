# AWS EC2
> 아마존 웹 서비스의 대표적인 서비스 

- 독립적인 컴퓨터를 임대해주는 상품.

## EC2 인스턴스
###  인스턴스 
- 온 디맨드 인스턴스  
    컴퓨터를 키면 과금이 발생하고 끄면 과금이 발생하지 않음.
- 예약 인스턴스  
    컴퓨터를 계속해서 끄지 않을 경우(서버 컴퓨터) 1년제, 3년제로 컴퓨터를 임대하여 좀 더 싸게 컴퓨터를 사용할 수 있음.

### AMIs (Amazone Machine Images)
> 이미지 : 머신(인스턴스)의 현재 상태를 그대로 얼려서 만든 것

- 만든 이미지를 다른 인스턴스를 만들 때 사용할 수 있음.
- 백업할 때 사용.  
    되돌리기 힘든 작업을 하기 전, 이미지를 생성함.
- 다른 사람이 만든 이미지를 통해 환경이 이미 셋팅된 인스턴스를 사용할 수 있음.  (marketplace)
    - ex) wordpress 이미지를 사용해 인스턴스를 생성하면 wordpress가 설치되어있는 환경을 직접 구성하지 않아도 wordpress를 사용할 수 있음. 

### EC2 인스턴스의 특징 (클라우드 컴퓨팅의 핵심적인 아이디어)
### 가상화  
가상머신 : 물리적인 컴퓨터 위에서 소프트웨어로 만든 컴퓨터. (운영체제 위에 설치되어있는 프로그램)

- 개인용 시장
    - VMware,virtualBox 등
    - 개인 사용 ex) 맥 사용자가 인터넷 뱅킹을 위해 윈도우 운영체제를 사용해야 할 때
- 기업용 시장
    - 클라우드 컴퓨팅
    - AWS에서는 물리적인 컴퓨터 여러개를 묶어 마치 한대의 컴퓨터 인 것 같이 강력한 컴퓨터(가상머신)를 만들거나, 하나의 컴퓨터를 작게 나눠 소규모 컴퓨터를 여러개 만듬.

### 종량제
규모의 경제를 통한 비용 절감에 따른 지속적 가격  인하 및 종량제를 통한 효율적 과금 체계

<b>사양이 높은 컴퓨터를 사용하면 과금이 크고, 사양이 낮은 컴퓨터를 사용하면 과금이 작음</b>

## Scalability
<i>얼마나 많은 컴퓨터에 대한 요구를 수용할 수 있는가.</i>  
 <i>변화하는 수요에 얼마나 탄력적으로 공급을 변화할 수 있는가.</i>

 웹 페이지를 사용하는 사용자는 가변적이나, 서버 컴퓨터는 가변적이지 않음. 
 
 사용자가 늘 때는 컴퓨터의 성능을 따라가지 못하고, 컴퓨터의 성능을 높였을 때 사용자가 줄면 낭비가 발생함.

클라우드 컴퓨팅은 수요(접속자)와 공급(컴퓨터)를 조절할 수 있음.(비용 효율적)  
사용자가 늘면 컴퓨터를 생성,사용자가 줄면 컴퓨터를 삭제함.

### scala up 
> 수요가 늘면 더 좋은 컴퓨터로 업그레이드 하는 것.

#### Elastic IPs (고정 아이피)
> 동적으로 변하는 아이피가 아닌 고정 IP address를 아마존으로부터 받고, 그것을 소유하는 것

- AWS에서는 과금됨
- 고정 아이피를 받고 하나의 인스턴스에 붙일 경우는 무료.
- 고정 아이피를 받고 인스턴스에 붙이지 않을 경우 과금.
- 하나의 인스턴스에 여러 개 고정 아이피를 붙일 경우 과금.

#### scale up 과정
1. 기존의 인스턴스를 이미지화.  
    (인스턴스가 잠깐 멈춤)
2. 더 좋은 인스턴스로 교체
3. 고정 아이피 옮김.   
    (Elastic IPs에서 고정 아이피를 인스턴스 변경)

인스턴스를 이미지화 할 때 인스턴스가 잠깐 멈추므로 (서버 접속이 끊김)신중하게 해야함.

### scale out
> 여러 대의 컴퓨터를 연결해서 협력해 일을 하는 것.

수요가 많아져 `scale up`을 하다보면 단일 컴퓨터로서 한계가 있기 때문에 `scale out`이 필요함.

- 컴퓨터 한대가 담당하고 있었던 것을 나눔.
- 여러 대의 컴퓨터가 협동해서 일을 처리함.  
    - 한 컴퓨터에서 웹 서버, 미들웨어, 데이터베이스를 처리하는 것을 `scale out`을 해서 컴퓨터별로 역할을 나눠 처리하게 함.
    - ex) 한대의 컴퓨터에선 웹 서버, 미들웨어를 처리하고 다른 컴퓨터에선 데이터베이스를 처리하고 있을 때   
    데이터베이스가 방대해질 경우 새로운 컴퓨터에 데이터베이스를 하나 더 설치하고 기존 데이터베이스에 추가,삭제되는 데이터를 복사하여 두개의 데이터베이스의 상태를 동일하게 함.  
    <b>읽기,쓰기 하는 데이터베이스를 나눔.</b>

![scale_up-scale_out](https://turbonomic.com/wp-content/uploads/2015/05/ScaleUpScaleOut_sm-min.jpg)


### Load Balancer(ELB)
> 사용자의 접속을 적당한 서버로 보내주는 중계자.   
부하의 균형을 잡아줘 부하가 골고루 분산될 수 있게하는 시스템

![load balanber](https://docs.microsoft.com/ko-kr/azure/load-balancer/media/load-balancer-overview/ic727496.png)

- 웹 서비스를 처리하는 웹 서버가 나눠져 있을 때, `Load Balancer`의 아이피로 접속하면 `Load Balancer`가 적당한 서버로 요청을 하여 결과를 받아와 사용자에게 뿌려줌.
- AWS가 직접 관리해줌. `Elastic Load Balancer`

#### Health check
`Load Balancer`는 각각의 인스턴스에 사용자들의 요청을 분산해주기 때문에
정기적으로 각각의 인스턴스에 접속해서 살아있는지 죽어있는지 확인함.

방법 : 각 서버의 index.html에 ELB가 접속했을 때 접속할 수 있다면 컴퓨터가 살아있다는 것이고, 오류가 있다면 사용자의 요청을 그 서버로 돌리지 않음.

#### ELB 주의사항
<b><i>데이터 베이스를 포함한 인스턴스는 ELB를 사용할 때 조심해야함.</i></b>

- 웹 서버는 정적인 파일이기 때문에(로직이 같기) ELB를 통해 어느 서버를 접속해도 사용자에게 응답하는 결과는 같지만,  
데이터베이스는 동적인 파일이고 사용자에 의해 값이 추가,삭제되기 때문에 ELB를 통해 접속할 때 응답하는 결과가 다를 수 있어짐.

ex) 인스턴스1 database와 인스턴스2 database가 scale out으로 나눠져 있을 경우

user1이 ELB를 통해 인스턴스1 database에 글을 저장하고 다시 글을 보려고 할 때
ELB를 통해  인스턴스2를 접속하게 되면 자신이 쓴 글을 볼 수 없음.(user1이 쓴 글은 인스턴스1 database에 저장되어있기 때문)

따라서 , 데이터베이스는 별도의 컴퓨터를 빼서 그 컴퓨터에 저장해야함.(데이터베이스의 복사본을 만들던가)  
이렇게 하면 ELB가 어느 쪽의 있는 웹 서버로 사용자의 요청을 보내더라도 동일한 데이터베이스에 있는 데이터를 CRUD할 수 있음.

## refer 
[생활코딩 AWS](https://www.youtube.com/playlist?list=PLuHgQVnccGMC5AYnBg8ffg5utOLwEj4fZ&disable_polymer=true)