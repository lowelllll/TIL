# 테이블 설계

관계형 데이터베이스에서는 테이블을 사용해 데이터를 적절히 다루는 것이 중요함.

#### 테이블 

> 공통 속성을 가진 것의 집합

테이블 설계는 <b>논리 설계</b>.

테이블은 공통적인 요소의 집합이라는 조건이 있음.

| 열1            | 열2    | 열3      |
| -------------- | ------ | -------- |
| 오늘 저녁 반찬 | 술     | 배추     |
| 이모씨         | 박모씨 | 김모씨   |
| 남동생         | 010    | 으앙ㅋㅋ |

이것은 테이블이 아님.(공통적이지 않음)

## 테이블 설계 규칙

1. '테이블명은 반드시 복수형이나 집합명사로 표현해야 한다.'

   - 테이블은 어떤 공통의  속성을 가진 것의 집합이여야함.

        과일 테이블		

   | 과일 번호 | 과일 이름 |
   | :-------- | --------- |
   | 1         | 수박      |
   | 2         | 딸기      |

   - 사물의 집합과 계층성을 무시해서는 안됨.

     완두콩 테이블

     | 이름   | 색   |
     | ------ | ---- |
     | 완두콩 | 초록 |

     토마토 테이블		

     | 이름   | 색   |
     | ------ | ---- |
     | 토마토 | 빨강 |

     위 테이블들은 계층성을 무시한 테이블이므로 옳지 않음.

     시스템 확장성이 0임.

2. '가장 상위의 개념집합으로 정리한다.'

   - 회원 테이블에서 회원을 일반/프리미엄 으로 나누고 싶을 경우 열로 나누어 표현함.

     | 회원번호 | 회원이름 | 등급     |
     | -------- | -------- | -------- |
     | 1        | 홍길동   | 프리미엄 |
     | 2        | 이예진   | 일반     |

     이렇게 표현한다면 SQL문의 `WHERE`절로 열을 간단하게 제어할 수 있음.

     ```sql
     select 회원번호 from 회원 where 등급 = '일반';
     ```

3. 반드시 기본키를 설정할 것.

   - 한 개 테이블의 내용에는 중복 행을 허용하지 않음.
   - 동명이인이 테이블에 저장된 경우 어느 행이 특정 인물에 대응하는지 알 수 없기 때문에 관계형 데이터베이스는 반드시 레코드를 고유하게 식별가능한 정보가 필요함.(기본키 열)
   - 회원 테이블이라면 회원 ID, 회원 번호 같은 절대로 중복되지 않는 숫자나 문자열에 의한 기본키를 할당하는 것이 일반적
   - 기본키 열에는 `NULL`이 존재해서는 안됨.

데이터 관리는 등록한 그 시점에만 정합성이 있어야 하는 것이 아닌 장기적으로 정합성을 얻는 노력을 해야함.(데이터는 정적이 아닌 동적이기 때문)

## 정규형

> '테이블은 이렇게 정의되어야 한다'는 이론의 기본

- 제대로 된 형태
- 데이터의 갱신이 발생한 경우에도 부정합이 발생하기 어려운 테이블의 형태

#### 정규화의 목적

갱신 이상을 없애는 것.



### 제 1정규형(1NF)

> '테이블 셀에 복합적인 값을 포함하지 않는다.'

관계형 데이터베이스는 이 정의에 반하는 테이블을 작성하는 것이 불가능함.

<b>복합적인 값</b> : 배열

| 주민번호 | 이름   | 나이 | 직업        |
| -------- | ------ | ---- | ----------- |
| 1        | 홍길동 | 19   | 학생        |
| 2        | 이예진 | 19   | 학생,개발자 |

위와 같은 테이블을 작성하는 것은 불가능.

복합적인 값을 사용하기 위해선 테이블을 나눠야함.

사람 테이블

| 주민번호 | 이름   | 나이 |
| -------- | ------ | ---- |
| 1        | 홍길동 | 19   |
| 2        | 이예진 | 19   |

직업 테이블

| 주민번호 | 직업   |
| -------- | ------ |
| 1        | 학생   |
| 2        | 학생   |
| 2        | 개발자 |

(개선된 방법이긴 하지만 더욱 좋은 방법도 있는 것 같다.)

제 1정규형이란 '스칼라 값 이외의 값을 포함하지 않는 테이블'이라고 말할 수 있음.

#### 테이블은 함수

정규형에는 '기본키를 특정하면 어떤 레코드의 열 값 전체가 고유하게 특정된다.'라는 규칙이 있으며 이 규칙은 

'기본키와 그 외의 열 사이에는 함수적인 관계가 있다'라는 뜻임.

##### 함수의 종속성

> 기본키와 다른 열 사이에 성립하는 함수적인 유일성

```
{주민번호} -> {이름}
```

주민번호(기본키)를 통해 이름을 알아낼 수 있음.

```
{주민번호} -> {나이}
```

주민번호를 통해 나이를 알아낼 수 있음.

### 제 2정규형(2NF)

> 기본 키를 구성하는 열의 일부에만 함수 종속이 존재하는 것(부분함수 종속)을 분리함.

<b>부분함수 종속</b>이 존재할 경우 해당 키와 종속하는 열만 다른 테이블로 만들어 외부로 꺼내야함.

| 고객기업 ID | 주문번호 | 주문 접수일 | 고객기업 명 |
| ----------- | -------- | ----------- | ----------- |
| CA          | 001      | 2018/07/27  | A상사       |
| CA          | 002      | 2018/04/24  | A상사       |
| CB          | 001      | 2018/01/09  | B상사       |
| CB          | 003      | 2017/08/19  | B상사       |

위 테이블의 기본키는 `{고객기업 ID,주문번호}` 의 조합으로 이 조합으로 행을 유일하게 특정하기 때문에 둘다 단독으로는 고유성을 가지지 않음.

```
{고객기업 ID} -> {고객기업 명}
```

```
{주문번호} -> {주문 접수일}
```

부분함수 종속이 존재함으로 테이블을 나눠야함.

고객기업주문 테이블

| 주문번호 | 고객기업 ID | 주문 접수일 |
| -------- | ----------- | ----------- |
| 001      | CA          | 2018/07/27  |
| 002      | CA          | 2018/04/24  |
| 001      | CB          | 2018/01/09  |
| 002      | CB          | 2017/08/19  |

고객기업 테이블

| 고객기업 ID | 고객기업 명 |
| ----------- | ----------- |
| CA          | A상사       |
| CB          | B상사       |

### 제 3정규식(3NF)

> 기본키 이외의 키 간에 발생하는 함수 종속이 존재하는 것(추이함수 종속)을 분리함.

| 고객기업 ID | 고객기업 명 | 업계코드 | 업계명 |
| ----------- | ----------- | -------- | ------ |
| CA          | A상사       | D001     | 석유   |
| CB          | B상사       | D002     | 건설   |
| CC          | C화학       | D003     | 바이오 |

위 테이블에서 업계를 추가하고 싶어도 기업이라는 단위의 집합을 반영하고 있어서 추가되는 업계에 속한 기업과 거래를 하지 않은 이상 해당 업계의 레코드를 만들 수 없음.

#### 추이함수 종속

```
{고객기업 ID} -> {업계코드} -> {업계명}
```

기본 키에서 볼 때 2단계의 함수 종속이 존재하므로 테이블을 나누어 외부로 빼놓아야함.

고객기업 테이블

| 고객기업 ID | 고객기업 명 |
| ----------- | ----------- |
| CA          | A상사       |
| CB          | B상사       |
| CC          | C화학       |

업계 테이블

| 업계코드 | 업계명 |
| -------- | ------ |
| D001     | 석유   |
| D002     | 건설   |
| D003     | 바이오 |

## ER 다이어그램

> 테이블 간의 관련성을 한눈에 알 수 있게 고안된 기술

- 테이블간의 관계를 그래픽으로 이해하기 쉽도록 해줌.

![er diagram](https://t1.daumcdn.net/cfile/tistory/11783B3C4D11CC4736)
상자는 테이블, 선은 관계를 표현함.